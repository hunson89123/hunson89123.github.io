<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title class="text-center">æ±äº¬8æ—¥éŠ æ—…éŠæ‰‹å†Š</title>
    <link rel="stylesheet" href="css/pico.green.min.css">
    <link rel="stylesheet" href="css/flipdown.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/pico.colors.min.css">
    <!--
  ===================================
  Google Apps Scriptï¼ˆGASï¼‰ç«¯ API ç¯„ä¾‹ï¼ˆè«‹éƒ¨ç½²ç‚º Web Appï¼‰
  -----------------------------------
  1) å°‡ä¸‹åˆ—ç¨‹å¼è²¼åˆ° Google Apps Scriptï¼Œæ›ä¸Šä½ çš„å·¥ä½œè¡¨ ID èˆ‡å·¥ä½œè¡¨åç¨±ã€‚
  2) å°ˆæ¡ˆ > éƒ¨ç½² > æ–°éƒ¨ç½² > é¡å‹é¸ã€Œç¶²é æ‡‰ç”¨ç¨‹å¼ã€ï¼Œå­˜å–æ¬Šé™å»ºè­°ã€Œä»»ä½•æ“æœ‰é€£çµè€…ã€ã€‚
  3) å–å¾— Web App URLï¼Œè²¼å›æœ¬é ã€Œè¨­å®šã€ä¸­çš„è¼¸å…¥æ¡†ã€‚

  // ======= GAS: Code.gs =======

  // =============================

  å›å‚³ JSON æœŸæœ›æ ¼å¼ï¼š
  {
    "items": [
      {"date":"2025-12-25","time":"08:00","title":"å‡ºç™¼","location":"å°åŒ— â†’ æ±äº¬","notes":"NRT ç¬¬2èˆªç«™","link":""},
      {"date":"2025-12-27","time":"09:00","title":"è¶Šå¾ŒGALAæ»‘é›ªå ´","location":"GALA æ¹¯æ²¢","notes":"ç§Ÿæ¿/æ»‘é›ªèª²ç¨‹","link":"https://gala.co.jp/"}
    ]
  }
  ===================================
  -->
</head>

<body class="container-fluid">

    <header>
        <nav>
            <ul>
                <li>
                    <hgroup>
                        <h2>æ±äº¬8æ—¥éŠ æ—…éŠæ‰‹å†Š</h2>
                        <small>2025-12-25 â†’ 2026-01-01</small>
                    </hgroup>
                </li>
            </ul>
            <ul>
                <li><a href="#" class=""></a></li>
            </ul>
        </nav>

        <hgroup>
            <small id="countdownStatus" style="display:block; text-align:center;font-weight:bold;"></small>
            <div id="CDTimer" class="flipdown"></div>
        </hgroup>
        <div class="center-container">
            <button data-target="modal-flight-info" onclick="toggleModal(event)"
                class="outline contrast bi bi-airplane-fill"> èˆªç­è³‡è¨Š</button>
            <button data-target="modal-transport-tickets" onclick="toggleModal(event)"
                class="outline contrast bi bi-ticket-perforated-fill"> äº¤é€šç¥¨åˆ¸</button>
            <button id="flight-info" class="outline contrast bi bi-house-door-fill">ä½å®¿è³‡è¨Š</button>
        </div>
    </header>

    <main>

        <h2>è¡Œç¨‹ç°¡ä»‹</h2>
        <article>
            123456
        </article>
    </main>
    <dialog id="modal-flight-info">
        <article>
            <header>
                <p><small class="bi bi-airplane"></small> èˆªç­è³‡è¨Š</p>
            </header>
            <article class="pico-background-grey-50 container-fluid">
                <div class="row">
                    <small class="col"><strong>2025-12-25</strong></small>
                    <img src="images/china-airlines-logo-0.png" width="120">
                    <small class="col" dir="rtl"><strong>CI100</strong></small>
                </div>
                <div class="row">
                    <div class="col">
                        <small class="pico-color-blue-700">09:30</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">TPE</h1>
                            <small class="pico-color-grey-400">æ¡ƒåœ’åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                    <div class="center-container flex-column gap-0">
                        <div class="bi bi-airplane-fill turn-right-90"></div>
                        <small>3h</small>
                    </div>
                    <div class="col" dir="rtl">
                        <small class="pico-color-blue-700">13:30</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">NRT</h1>
                            <small class="pico-color-grey-400">æˆç”°åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                </div>
            </article>
            <article class="pico-background-grey-50 container-fluid">
                <div class="row">
                    <small class="col"><strong>2026-01-01</strong></small>
                    <img src="images/china-airlines-logo-0.png" width="120">
                    <div class="col" dir="rtl"><strong>CI101</strong></div>
                </div>
                <div class="row">
                    <div class="col">
                        <small class="pico-color-blue-700">14:35</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">NRT</h1>
                            <small class="pico-color-grey-400">æˆç”°åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                    <div class="center-container flex-column gap-0">
                        <div class="bi bi-airplane-fill turn-right-90"></div>
                        <small>4h 5m</small>
                    </div>
                    <div class="col" dir="rtl">
                        <small class="pico-color-blue-700">17:40</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">TPE</h1>
                            <small class="pico-color-grey-400">æ¡ƒåœ’åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                </div>
            </article>
            <footer>
                <small>â€»æ™‚é–“çš†ç‚ºç•¶åœ°æ™‚é–“</small>
            </footer>
        </article>
    </dialog>
    <dialog id="modal-transport-tickets">
        <article>
            <header>
                <p><small class="bi bi-ticket-perforated"></small> äº¤é€šç¥¨åˆ¸</p>
            </header>
            <div class="center-container flex-column">
                <img src="images/coming-soon.svg" width="100">
                <p>å»ºç½®ä¸­ï¼Œæ•¬è«‹æœŸå¾…:)</p>
            </div>
            <!-- <article class="pico-background-grey-50 container-fluid">
                <div class="row">
                    <small class="col"><strong>2025-12-25</strong></small>
                    <img src="images/china-airlines-logo-0.png" width="120">
                    <small class="col" dir="rtl"><strong>CI100</strong></small>
                </div>
                <div class="row">
                    <div class="col">
                        <small class="pico-color-blue-700">09:30</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">TPE</h1>
                            <small class="pico-color-grey-400">æ¡ƒåœ’åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                    <div class="center-container flex-column gap-0">
                        <div class="bi bi-airplane-fill turn-right-90"></div>
                        <small>3h</small>
                    </div>
                    <div class="col" dir="rtl">
                        <small class="pico-color-blue-700">13:30</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">NRT</h1>
                            <small class="pico-color-grey-400">æˆç”°åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                </div>
            </article>
            <article class="pico-background-grey-50 container-fluid">
                <div class="row">
                    <small class="col"><strong>2026-01-01</strong></small>
                    <img src="images/china-airlines-logo-0.png" width="120">
                    <div class="col" dir="rtl"><strong>CI101</strong></div>
                </div>
                <div class="row">
                    <div class="col">
                        <small class="pico-color-blue-700">14:35</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">NRT</h1>
                            <small class="pico-color-grey-400">æˆç”°åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                    <div class="center-container flex-column gap-0">
                        <div class="bi bi-airplane-fill turn-right-90"></div>
                        <small>4h 5m</small>
                    </div>
                    <div class="col" dir="rtl">
                        <small class="pico-color-blue-700">17:40</small>
                        <hgroup class="mb-0">
                            <h1 class="pico-color-grey-950">TPE</h1>
                            <small class="pico-color-grey-400">æ¡ƒåœ’åœ‹éš›æ©Ÿå ´T2</small>
                            <p></p>
                        </hgroup>
                    </div>
                </div>
            </article> -->
            <!-- <footer>
                <small>â€»æ™‚é–“çš†ç‚ºç•¶åœ°æ™‚é–“</small>
            </footer> -->
        </article>
    </dialog>
    <!-- <h2>æŒ‰éˆ•</h2>
    <button>ä¸»è¦æŒ‰éˆ•</button>
    <button class="secondary">æ¬¡è¦æŒ‰éˆ•</button>
    <button class="contrast">å¼·èª¿æŒ‰éˆ•</button>

    <h2>è¡¨å–®</h2>
    <form>
        <label for="email">é›»å­éƒµä»¶</label>
        <input type="email" id="email" name="email" placeholder="your@email.com" required>
        <label for="message">è¨Šæ¯</label>
        <textarea id="message" name="message" rows="3" placeholder="è¼¸å…¥å…§å®¹..."></textarea>
        <button type="submit">é€å‡º</button>
    </form>

    <h2>è¡¨æ ¼</h2>
    <table>
        <thead>
            <tr>
                <th>æ—¥æœŸ</th>
                <th>æ´»å‹•</th>
                <th>åœ°é»</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>2025/12/25</td>
                <td>å‡ºç™¼</td>
                <td>å°åŒ— â†’ æ±äº¬</td>
            </tr>
            <tr>
                <td>2025/12/27</td>
                <td>æ»‘é›ª</td>
                <td>GALA æ¹¯æ²¢</td>
            </tr>
        </tbody>
    </table>

    <h2>å¡ç‰‡å€å¡Š</h2>
    <article>
        <h3>æ±äº¬è¿ªå£«å°¼</h3>
        <p>äº«å—æ­¡æ¨‚çš„éŠæ¨‚è¨­æ–½èˆ‡è¡¨æ¼”ï¼Œåˆ¥å¿˜äº†æå‰è³¼ç¥¨ï¼</p>
        <footer>
            <a href="https://www.tokyodisneyresort.jp/" target="_blank">å®˜æ–¹ç¶²ç«™</a>
        </footer>
    </article>
    <header class="hero">
        <div class="container">
            <div class="trip-badge" role="status" aria-live="polite">
                <span>è¡Œç¨‹æ—¥æœŸ</span>
                <strong>2025/12/25</strong>
                <span>â†’</span>
                <strong>2026/01/01</strong>
            </div>
            <h1>æ±äº¬8æ—¥éŠæ‰‹å†Š</h1>
            <p class="sub">è¶Šå¾Œæ¹¯æ¾¤è»Šç«™ãƒ»GALA æ¹¯æ²¢ãƒ»æ±äº¬è¿ªå£«å°¼ãƒ»æ·ºè‰é›·é–€ãƒ»ä»²è¦‹ä¸–å•†åº—è¡—</p>

            <section aria-labelledby="countdown-title">
                <h2 id="countdown-title" class="visually-hidden">å‡ºç™¼å€’æ•¸</h2>
                <div class="countdown" id="countdown">
                </div>
                <div class="progress" aria-label="å€’æ•¸é€²åº¦">
                    <span id="progressBar"></span>
                </div>

            </section>

            <details style="margin-top:1rem">
                <summary>âš™ï¸ è¨­å®šï¼šGoogle Apps Script Web App URL</summary>
                <div class="grid" style="margin-top:.5rem">
                    <div>
                        <label for="gasUrl">GAS URL</label>
                        <input id="gasUrl" type="url" placeholder="https://script.google.com/macros/s/XXXX/exec" />
                        <small>å„²å­˜å¾ŒæœƒåŒæ­¥åˆ° localStorage</small>
                    </div>
                    <div style="align-self:end">
                        <button id="saveGasUrl" class="contrast">å„²å­˜ & é‡æ–°è¼‰å…¥è¡Œç¨‹</button>
                    </div>
                </div>
            </details>
        </div>
    </header> -->

    <!-- è¡Œç¨‹æ¸…å–® -->
    <!-- <main class="container" style="margin-top:2rem">
        <h2>è¡Œç¨‹ç¸½è¦½</h2>
        <p class="muted">è³‡æ–™å°‡è‡ª Google è©¦ç®—è¡¨ï¼ˆé€é GASï¼‰è®€å–ï¼›è‹¥ç„¡è¨­å®šï¼Œå°‡é¡¯ç¤ºé›¢ç·šç¯„ä¾‹è³‡æ–™ã€‚</p>

        <div id="itinerary"></div>
    </main>

    <footer class="container" style="margin:3rem auto 4rem">
        <hr />
        <small>Made with â™¥ï¸ for your Tokyo trip. æ™‚å€ï¼šAsia/Tokyoï¼ˆé¿å…è·¨å¹´è·¨æ™‚å€èª¤å·®ï¼‰ã€‚</small>
    </footer> -->
    <script src="js/flipdown.js"></script>
    <script src="js/modal.js"></script>
    <script>
        // === æ—…ç¨‹æ—¥æœŸ ===
        const TZ_OFFSET = '+09:00'; // æ—¥æœ¬æ™‚å€
        const TRIP_START = new Date('2025-12-25T13:30:00' + TZ_OFFSET);
        const TRIP_END = new Date('2026-01-01T18:40:40' + TZ_OFFSET);

        // === å€’æ•¸è¨ˆæ™‚ ===
        const countdownEl = document.getElementById('countdown');
        const statusEl = document.getElementById('countdownStatus');
        const progressBar = document.getElementById('progressBar');

        function fmt(n) { return String(n).padStart(2, '0'); }
        function renderCountdown(d, h, m, s) {
            countdownEl.innerHTML = '' +
                block(fmt(d), 'å¤©') +
                block(fmt(h), 'å°æ™‚') +
                block(fmt(m), 'åˆ†é˜') +
                block(fmt(s), 'ç§’');
        }
        function block(value, label) {
            return `<div class="block"><div class="digit" aria-label="${label}">${value}</div><div class="label">${label}</div></div>`;
        }
        function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

        function tick() {
            const now = new Date();
            if (now < TRIP_START) {
                const diff = TRIP_START - now;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
                const mins = Math.floor(diff / (1000 * 60)) % 60;
                const secs = Math.floor(diff / 1000) % 60;
                statusEl.textContent = `è·é›¢è¡Œç¨‹é–‹å§‹é‚„æœ‰...`;

                /*const totalSpan = TRIP_START - new Date('2025-01-01T00:00:00' + TZ_OFFSET); // åƒè€ƒç”¨ï¼šå¾å¹´åˆåˆ°å‡ºç™¼
                const elapsed = now - new Date('2025-01-01T00:00:00' + TZ_OFFSET);
                const pct = clamp((elapsed / totalSpan) * 100, 0, 100);
                progressBar.style.width = pct + '%';*/
            } else if (now <= TRIP_END) {
                // æ—…ç¨‹ä¸­ï¼šå€’æ•¸åˆ°çµæŸ
                const diff = TRIP_END - now;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
                const mins = Math.floor(diff / (1000 * 60)) % 60;
                const secs = Math.floor(diff / 1000) % 60;
                statusEl.textContent = `æ­£åœ¨æ—…ç¨‹ä¸­ï¼è·é›¢çµæŸé‚„æœ‰...`;
            } else {
                // æ—…ç¨‹çµæŸ
                statusEl.textContent = 'æ—…ç¨‹å·²çµæŸï¼ŒæœŸå¾…ä¸‹æ¬¡å†’éšªï¼';
            }
        }
        tick();
        setInterval(tick, 1000);

        // === è¡Œç¨‹è¼‰å…¥ï¼ˆGAS æˆ–é›¢ç·šç¯„ä¾‹ï¼‰===
        /*const itineraryEl = document.getElementById('itinerary');
        const gasInput = document.getElementById('gasUrl');
        const saveBtn = document.getElementById('saveGasUrl');

        gasInput.value = localStorage.getItem('gasUrl') || '';
        saveBtn.addEventListener('click', () => {
            const url = gasInput.value.trim();
            if (url) { localStorage.setItem('gasUrl', url); }
            loadItinerary();
        });*/

        async function loadItinerary() {
            const url = localStorage.getItem('gasUrl');
            let items = [];
            try {
                if (url) {
                    const res = await fetch(url, { cache: 'no-store' });
                    const data = await res.json();
                    items = (data && data.items) ? data.items : [];
                }
            } catch (err) {
                console.warn('GAS è¼‰å…¥å¤±æ•—ï¼Œæ”¹ç”¨é›¢ç·šè³‡æ–™', err);
            }
            if (!items.length) { items = offlineSample(); }
            renderItinerary(items);
        }

        function offlineSample() {
            return [
                { date: '2025-12-25', time: '07:30', title: 'å‡ºç™¼æ—¥', location: 'å°åŒ— â†’ æ±äº¬', notes: 'NRT å…¥å¢ƒï¼ŒSuica å……å€¼', link: '' },
                { date: '2025-12-26', time: '09:30', title: 'è¶Šå¾Œæ¹¯æ¾¤è»Šç«™', location: 'è¶Šå¾Œæ¹¯æ¾¤', notes: 'JR ä¸Šè¶Šæ–°å¹¹ç·šï¼›åˆé¤ç«™å…§ç¾é£Ÿè¡—', link: '' },
                { date: '2025-12-27', time: '08:30', title: 'è¶Šå¾Œ GALA æ»‘é›ªå ´', location: 'GALA æ¹¯æ²¢', notes: 'ç§Ÿè£å‚™ï¼åˆå­¸èª²ç¨‹ï¼Œæ³¨æ„è»Šç­', link: 'https://gala.co.jp/' },
                { date: '2025-12-28', time: '10:00', title: 'æ±äº¬è¿ªå£«å°¼', location: 'èˆæ¿±', notes: 'äº‹å…ˆè³¼ç¥¨ï¼Œä¸‹è¼‰ App é ç´„', link: 'https://www.tokyodisneyresort.jp/' },
                { date: '2025-12-29', time: '09:00', title: 'æ·ºè‰é›·é–€', location: 'æ·ºè‰', notes: 'æ‹ç…§äººæ½®å¤šï¼Œæ—©é»åˆ°', link: '' },
                { date: '2025-12-29', time: '11:00', title: 'ä»²è¦‹ä¸–å•†åº—è¡—', location: 'æ·ºè‰', notes: 'ä¼´æ‰‹ç¦®æ•£ç­–ã€æ·ºè‰å¯º', link: '' },
                { date: '2026-01-01', time: '', title: 'è¿”ç¨‹', location: 'æ±äº¬ â†’ å°åŒ—', notes: 'é ç•™æ©Ÿå ´æ™‚é–“', link: '' }
            ];
        }

        function groupByDate(items) {
            const map = new Map();
            for (const it of items) {
                const key = it.date || 'æœªæŒ‡å®šæ—¥æœŸ';
                if (!map.has(key)) map.set(key, []);
                map.get(key).push(it);
            }
            // ä¾æ—¥æœŸæ’åºï¼ˆå­—ä¸² yyyy-MM-dd å¯ç›´æ¥æ’åºï¼‰
            return [...map.entries()].sort((a, b) => a[0].localeCompare(b[0]));
        }

        function renderItinerary(items) {
            const groups = groupByDate(items);
            itineraryEl.innerHTML = groups.map(([date, arr]) => {
                const cards = arr
                    .sort((a, b) => (a.time || '').localeCompare(b.time || ''))
                    .map(it => card(it))
                    .join('');
                const dateLabel = dateFmt(date);
                return `<article>
          <header style="margin:.5rem 0 1rem"><h3 style="margin:0">ğŸ“… ${dateLabel}</h3></header>
          <div class="grid">${cards}</div>
        </article>`;
            }).join('');
        }

        function card(it) {
            const link = it.link ? `<a href="${it.link}" target="_blank" rel="noopener">å®˜æ–¹ / åƒè€ƒé€£çµ</a>` : '';
            const time = it.time ? `<span class="chip" aria-label="æ™‚é–“"><strong>â° ${it.time}</strong></span>` : '';
            const loc = it.location ? `<span class="chip" aria-label="åœ°é»">ğŸ“ ${escapeHtml(it.location)}</span>` : '';
            return `<div class="card">
        <h4 style="margin:.25rem 0 .5rem">${escapeHtml(it.title || 'æœªå‘½å')}</h4>
        <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin-bottom:.5rem">${time}${loc}</div>
        <p class="muted" style="min-height:2.5em">${escapeHtml(it.notes || '')}</p>
        ${link}
      </div>`;
        }

        function dateFmt(s) {
            if (!/\d{4}-\d{2}-\d{2}/.test(s)) return s;
            const [y, m, d] = s.split('-');
            return `${y}/${m}/${d}`;
        }

        function escapeHtml(str) {
            return String(str).replace(/[&<>"] /g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', ' ': '&nbsp;' }[s]));
        }

        // åˆå§‹è¼‰å…¥
        //loadItinerary();
        document.addEventListener('DOMContentLoaded', () => {
            let flipdown = new FlipDown(Math.floor(TRIP_START.getTime() / 1000), "CDTimer", {
                headings: ["å¤©", "æ™‚", "åˆ†", "ç§’"],
                theme: getSystemThemeReverse(),
            }).start();
        });
        function getSystemThemeReverse() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches
                ? "light"
                : "dark";
        }

        const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");

        function updateTheme(e) {
            const newTheme = e.matches ? "light" : "dark";
            let body = document.body;
            body.querySelector('#CDTimer').classList.toggle('flipdown__theme-dark');
            body.querySelector('#CDTimer').classList.toggle('flipdown__theme-light');
        }

        mediaQuery.addEventListener("change", updateTheme);

        const modal = document.getElementById("myModal");
        const openBtn = document.getElementById("flight-info");
        const closeBtn = document.getElementById("closeModal");

        openBtn.addEventListener("click", () => {
            modal.showModal(); // é¡¯ç¤º modal
        });

        closeBtn.addEventListener("click", () => {
            modal.close(); // é—œé–‰ modal
        });
    </script>
</body>

</html>